# 主支线任务与目标系统设计文档

本文档详细描述了LAE系统中的核心功能模块——主支线任务与目标管理系统的设计方案。该系统旨在帮助用户以层级化的方式定义、追踪和管理其长期目标与具体行动。

## 1. 核心理念

本系统的设计核心是将宏大的、长期的目标（**Quest/主线任务**）分解为具体的、可执行的、有时间属性的行动计划（**Objective/目标**）。通过这种方式，用户可以清晰地看到为了实现一个大目标，需要完成哪些具体步骤，并对这些步骤进行有效的日程管理。

## 2. 数据模型

系统包含两个核心数据表：`Quest` 和 `Objective`。

### 2.1. Quest 表 (主/支线任务)

此表用于定义一个长期的项目、一个重要的生活领域或一个宏大的目标。任务之间可以形成父子关系，构成一个任务树。

-   **`id`**: INTEGER, 内部自增主键，用于数据库内部关联。
-   **`quest_id`**: TEXT, 用户可输入的层级化ID，例如 "1", "1.1", "1.1.2"，用于直观展示任务的层级结构。
-   **`name`**: TEXT, 任务的名称，例如 "完成硕士学位论文"。
-   **`parent_id`**: INTEGER, 指向 `Quest.id` 的外键，用于构建任务的父子层级关系。根任务此字段为空。
-   **`status`**: TEXT, 任务的当前状态。枚举值包括: "进行中", "已完成", "已暂停", "已放弃"。
-   **`progress`**: TEXT, 用户输入的、对进度的自由描述，例如 "75%", "已完成文献综述", "等待导师反馈"。
-   **`target_frequency`**: TEXT, 用户设定的目标执行频率，例如 "3次/周", "1次/月"。
-   **`target_duration`**: TEXT, 用户设定的目标投入时长，例如 "5小时/周", "20小时/月"。
-   **`description`**: TEXT, 对任务的详细描述、笔记或备注。

### 2.2. Objective 表 (目标/日程)

此表用于定义一个具体的、可操作的、与特定Quest关联的行动项。它是日程规划的基本单位。

-   **`id`**: INTEGER, 内部自增主键。
-   **`linked_quest_id`**: INTEGER, 指向 `Quest.id` 的外键，表明此目标服务于哪个主线任务。
-   **`name`**: TEXT, 目标的名称，例如 "去图书馆办理借阅证", "完成论文第三章初稿"。
-   **`status`**: TEXT, 目标的状态。枚举值包括: "待办", "进行中", "已完成", "已取消"。
-   **`time_type`**: TEXT, 定义目标的时间约束类型。
    -   **Fixed**: 固定时间，具有明确的开始和结束时间。
    -   **Range**: 时间范围，可在指定日期范围内的任意时间完成。
    -   **Recurring**: 周期性任务，根据特定规则重复出现。
    -   **Deadline**: 截止日期，必须在某个时间点之前完成。
    -   **Flexible**: 灵活任务，执行时间由特定状态或条件触发。
-   **`start_date_time` / `end_date_time`**: DATETIME, 用于存储上述时间约束的具体时间值。
-   **`recurring_rule`**: TEXT, 存储周期性任务的规则，例如 "每周一、三、五", "每月15日"。
-   **`conditions`**: TEXT (或 JSON), 存储灵活任务的执行条件。例如: `{"type": "state", "metric": "energy", "value": ">80"}` 表示当精力值大于80时才适合执行此任务。
-   **`description`**: TEXT, 对目标的详细描述或备注。

## 3. 核心约束

-   **无独立时间记录**: 本系统专注于任务和目标的**定义、规划与状态追踪**。具体的活动时间记录（例如，用户在“写论文”这个Objective上实际花费了多少分钟）由另一个独立的“时间日志”模块处理，以保持模块职责的单一性。

